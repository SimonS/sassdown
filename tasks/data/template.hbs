<!DOCTYPE html>
<html lang="en">
<head>
    <title>{{ page.heading }}</title>
</head>
<body>

    <div class="navigation">
        <div class="gutter">
            <ul>
            {{#each pages}}
                <li>
                    {{#if is_directory }}
                        <h2>{{ name }}</h2>
                        <ul>
                        {{#each pages}}
                            <li>
                                {{#if is_directory }}
                                    <h2>{{ name }}</h2>
                                    <ul>
                                    {{#each pages}}
                                        <li>
                                            {{#if is_directory }}
                                                <h2>{{ name }}</h2>
                                                <ul>
                                                {{#each pages}}
                                                    <li>
                                                        <a href="{{> root}}/{{ href }}">{{ title }}</a>
                                                    </li>
                                                {{/each}}
                                                </ul>
                                            {{else}}
                                                <a href="{{> root}}/{{ href }}">{{ title }}</a>
                                            {{/if}}
                                        </li>
                                    {{/each}}
                                    </ul>
                                {{else}}
                                    <a href="{{> root}}/{{ href }}">{{ title }}</a>
                                {{/if}}
                            </li>
                        {{/each}}
                        </ul>
                    {{else}}
                        <a href="{{> root}}/{{ href }}">{{ title }}</a>
                    {{/if}}
                </li>
            {{/each}}
            </ul>
        </div>
    </div>

    <div class="gutter">
        {{#each page.sections }}
            <div class="section">
                {{#if comment}}
                    <div class="comment">{{{comment}}}</div>
                {{/if}}
                {{#if result}}
                    <div class="result">
                        <iframe id="iframe_{{{id}}}" height="0" src="about:blank"></iframe>
                        <script id="script_{{{id}}}">
                            var iframe  = document.getElementById('iframe_{{{id}}}');
                            var context = iframe.contentWindow.document;
                            var script  = document.getElementById('script_{{{id}}}');
                            context.open();
                            context.write('<!doctype html>'
                                +'<html>'
                                +'    <head>'
                                +'        {{> assets}}'
                                +'    </head>'
                                +'    <body>'
                                +'        {{{result}}}'
                                +'    </body>'
                                +'</html>');
                            context.close();
                            script.parentNode.removeChild(script);
                        </script>
                    </div>
                {{/if}}
                {{#if markup}}
                    <div class="markup">{{{markup}}}</div>
                {{/if}}
            </div>
        {{/each}}
    </div>

    <script>
        window.onload = function() {
            var iframes = document.querySelectorAll('iframe');
            for ( var i = 0; i < iframes.length; i++ ){
                iframes[i].height = iframes[i].contentWindow.document.body.scrollHeight;
            }
        };
    </script>

    {{> theme}}

</body>
</html>
